# ğŸ—ï¸ ASMO-01 - Architecture dÃ©taillÃ©e

## ğŸ“ Vue d'ensemble du systÃ¨me

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ASMO-01 Server                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    Docker Containers                        â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”   â”‚    â”‚
â”‚  â”‚  â”‚n8n   â”‚ â”‚Jellyfinâ”‚Vault â”‚ â”‚Grafanaâ”‚Home  â”‚ â”‚Homarrâ”‚   â”‚    â”‚
â”‚  â”‚  â”‚      â”‚ â”‚        â”‚wardenâ”‚ â”‚       â”‚Assistâ”‚ â”‚      â”‚   â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜   â”‚    â”‚
â”‚  â”‚  ... (24 containers total)                                 â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              Health Monitoring System                       â”‚    â”‚
â”‚  â”‚  /home/asmo/scripts/asmo-health/                                â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ src/                                                   â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ monitor.py    (hourly collection)                â”‚    â”‚
â”‚  â”‚  â”‚   â”œâ”€â”€ reporter.py   (daily analysis)                   â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ utils/        (Docker + System metrics)          â”‚    â”‚
â”‚  â”‚  â”œâ”€â”€ data/                                                  â”‚    â”‚
â”‚  â”‚  â”‚   â””â”€â”€ health_history.json  (7 days retention)          â”‚    â”‚
â”‚  â”‚  â””â”€â”€ logs/                                                  â”‚    â”‚
â”‚  â”‚      â””â”€â”€ asmo.log                                           â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ SSH Commands
                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚     n8n Workflows  â”‚
                    â”‚   (Automation)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  Discord Webhook   â”‚
                    â”‚   (Notifications)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de donnÃ©es - Monitoring Horaire

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n Cron  â”‚  Every hour: 0 * * * *
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  monitor.py                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Collect System Metrics                         â”‚  â”‚
â”‚  â”‚    â€¢ CPU usage (psutil)                           â”‚  â”‚
â”‚  â”‚    â€¢ RAM usage (psutil)                           â”‚  â”‚
â”‚  â”‚    â€¢ Disk usage (psutil)                          â”‚  â”‚
â”‚  â”‚    â€¢ Network I/O (psutil)                         â”‚  â”‚
â”‚  â”‚    â€¢ System uptime                                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. Collect Docker Metrics                         â”‚  â”‚
â”‚  â”‚    â€¢ Container list (docker.py API)               â”‚  â”‚
â”‚  â”‚    â€¢ Container status (running/stopped/unhealthy) â”‚  â”‚
â”‚  â”‚    â€¢ CPU & RAM per container                      â”‚  â”‚
â”‚  â”‚    â€¢ Network I/O per container                    â”‚  â”‚
â”‚  â”‚    â€¢ Restart count                                â”‚  â”‚
â”‚  â”‚    â€¢ Recent error logs (last 50 lines)            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. Analyze Thresholds                             â”‚  â”‚
â”‚  â”‚    â€¢ Check CPU > 95% (critical)                   â”‚  â”‚
â”‚  â”‚    â€¢ Check RAM > 95% (critical)                   â”‚  â”‚
â”‚  â”‚    â€¢ Check disk > 90% (critical)                  â”‚  â”‚
â”‚  â”‚    â€¢ Check unhealthy containers                   â”‚  â”‚
â”‚  â”‚    â€¢ Check restart counts                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. Store in History                               â”‚  â”‚
â”‚  â”‚    data/health_history.json                       â”‚  â”‚
â”‚  â”‚    [                                              â”‚  â”‚
â”‚  â”‚      { timestamp: "...", metrics: {...} },        â”‚  â”‚
â”‚  â”‚      { timestamp: "...", metrics: {...} },        â”‚  â”‚
â”‚  â”‚      ...                                           â”‚  â”‚
â”‚  â”‚    ]                                               â”‚  â”‚
â”‚  â”‚    Auto-cleanup: Keep last 7 days                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. Return JSON Output                             â”‚  â”‚
â”‚  â”‚    {                                               â”‚  â”‚
â”‚  â”‚      "success": true,                              â”‚  â”‚
â”‚  â”‚      "critical_alert": false,                      â”‚  â”‚
â”‚  â”‚      "summary": {...}                              â”‚  â”‚
â”‚  â”‚    }                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Optional: IF critical_alert == true   â”‚
â”‚  â†’ Send immediate Discord alert        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Flux de donnÃ©es - Rapport Journalier

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n Cron  â”‚  Daily at 9:00 AM: 0 9 * * *
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  reporter.py                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Load 24h History                               â”‚  â”‚
â”‚  â”‚    storage.get_last_24h()                         â”‚  â”‚
â”‚  â”‚    â†’ Returns ~24 entries (hourly snapshots)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 2. Analyze Trends                                 â”‚  â”‚
â”‚  â”‚    â€¢ CPU: avg, min, max over 24h                  â”‚  â”‚
â”‚  â”‚    â€¢ RAM: avg, min, max over 24h                  â”‚  â”‚
â”‚  â”‚    â€¢ Disk: trends                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 3. Analyze Container Health                       â”‚  â”‚
â”‚  â”‚    For each container:                            â”‚  â”‚
â”‚  â”‚    â€¢ Calculate uptime % (running vs down checks)  â”‚  â”‚
â”‚  â”‚    â€¢ Aggregate restart counts                     â”‚  â”‚
â”‚  â”‚    â€¢ Collect unique errors                        â”‚  â”‚
â”‚  â”‚    â€¢ Calculate avg/max resource usage             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 4. Identify Problems                              â”‚  â”‚
â”‚  â”‚    â€¢ Containers with uptime < 100%                â”‚  â”‚
â”‚  â”‚    â€¢ Containers with restarts                     â”‚  â”‚
â”‚  â”‚    â€¢ Containers with errors                       â”‚  â”‚
â”‚  â”‚    â€¢ Severity: critical / warning / info          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 5. Get Top Resource Consumers                     â”‚  â”‚
â”‚  â”‚    â€¢ Top 5 by memory usage                        â”‚  â”‚
â”‚  â”‚    â€¢ Top 5 by CPU usage                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 6. Generate Discord Embed                         â”‚  â”‚
â”‚  â”‚    {                                               â”‚  â”‚
â”‚  â”‚      "embeds": [{                                  â”‚  â”‚
â”‚  â”‚        "title": "âœ… ASMO-01 â€¢ 24h Report",         â”‚  â”‚
â”‚  â”‚        "fields": [                                 â”‚  â”‚
â”‚  â”‚          { "name": "Current State", ... },         â”‚  â”‚
â”‚  â”‚          { "name": "Issues", ... },                â”‚  â”‚
â”‚  â”‚          { "name": "Top Memory", ... },            â”‚  â”‚
â”‚  â”‚          { "name": "Top CPU", ... }                â”‚  â”‚
â”‚  â”‚        ]                                           â”‚  â”‚
â”‚  â”‚      }]                                            â”‚  â”‚
â”‚  â”‚    }                                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  n8n HTTP Request Node                 â”‚
â”‚  POST to Discord Webhook               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚   Discord    â”‚
         â”‚   Channel    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ—„ï¸ Structure des donnÃ©es

### EntrÃ©e d'historique (health_history.json)

```json
{
  "timestamp": "2026-01-11T10:00:00.123456",
  "cpu_percent": 15.3,
  "cpu_count": 8,
  "ram_total_gb": 16.0,
  "ram_used_gb": 5.5,
  "ram_percent": 34.4,
  "swap_total_gb": 4.0,
  "swap_used_gb": 0.0,
  "disks": [
    {
      "mount": "/",
      "device": "/dev/nvme0n1p2",
      "total_gb": 457.0,
      "used_gb": 115.0,
      "used_percent": 27.0
    },
    {
      "mount": "/mnt/nas",
      "device": "/dev/sda1",
      "total_gb": 3600.0,
      "used_gb": 1100.0,
      "used_percent": 31.0
    }
  ],
  "uptime": "15d 7h 23m",
  "load_average": [1.5, 1.3, 1.2],
  "containers": [
    {
      "name": "jellyfin",
      "id": "abc123",
      "status": "running",
      "state": "running",
      "health": "healthy",
      "cpu_percent": 0.21,
      "mem_mb": 308.2,
      "mem_percent": 1.9,
      "net_rx_mb": 13.3,
      "net_tx_mb": 1.58,
      "restarts": 0,
      "errors": [
        "SQLite Error 5: database is locked",
        "..."
      ]
    }
  ],
  "containers_total": 24,
  "containers_running": 24,
  "containers_stopped": 0,
  "containers_unhealthy": 0,
  "alert": {
    "has_critical": false,
    "critical_issues": [],
    "warnings": []
  }
}
```

---

## ğŸ”Œ IntÃ©grations externes

### Docker Socket
```
/var/run/docker.sock
   â†“ (unix socket)
DockerMonitor (docker.py client)
   â†“
Container stats, logs, health
```

### SystÃ¨me Linux
```
psutil library
   â†“
/proc filesystem
   â†“
CPU, RAM, Disk, Network metrics
```

### n8n Workflows
```
Schedule Trigger (cron)
   â†“
Execute Command (SSH)
   â†“
Python scripts
   â†“
JSON output
   â†“
HTTP Request (Discord)
```

---

## ğŸ” SÃ©curitÃ© & Permissions

### Permissions requises

```
Docker Socket:
  â€¢ User doit Ãªtre dans le groupe 'docker'
  â€¢ Permission lecture sur /var/run/docker.sock

Filesystem:
  â€¢ Lecture: /proc (psutil)
  â€¢ Ã‰criture: /home/asmo/scripts/asmo-health/data/
  â€¢ Ã‰criture: /home/asmo/scripts/asmo-health/logs/

Network:
  â€¢ Sortant uniquement (vers Discord webhook)
  â€¢ Pas de port listen
```

### DonnÃ©es sensibles

```
config.json (gitignored):
  â€¢ Discord webhook URLs
  â€¢ Chemins locaux
  â€¢ Seuils personnalisÃ©s

health_history.json (gitignored):
  â€¢ Noms de containers
  â€¢ MÃ©triques systÃ¨me
  â€¢ Logs d'erreurs (peuvent contenir des infos)
```

---

## ğŸ“ˆ ScalabilitÃ©

### Limites actuelles

```
Containers: TestÃ© jusqu'Ã  30 containers
History:    7 jours Ã— 24 entrÃ©es = ~168 entrÃ©es
File size:  ~500 KB - 2 MB (selon verbositÃ© des erreurs)
RAM usage:  ~50-100 MB pendant l'exÃ©cution
CPU usage:  ~5-10% pendant 2-3 secondes
```

### Pour scaler

```
Plus de containers (50+):
  â†’ Augmenter retention_days si besoin
  â†’ Filtrer les containers non-critiques

Monitoring plus frÃ©quent (15 min):
  â†’ 4Ã— plus d'entrÃ©es
  â†’ RÃ©duire retention_days Ã  3-4 jours

Multi-serveurs:
  â†’ DÃ©ployer sur chaque serveur
  â†’ Centraliser les rapports (future feature)
```

---

## ğŸ”„ Cycle de vie des donnÃ©es

```
Collection (hourly)
   â†“
health_history.json
   â†“
Retention: 7 days
   â†“
Auto-cleanup (when adding new entry)
   â†“
Old entries deleted

Logs (continuous)
   â†“
asmo.log
   â†“
Rotation: Manual (future: logrotate)
```

---

## ğŸ¯ Points d'extension

### Ajouter une nouvelle mÃ©trique

1. **Dans `metrics.py`**: Ajouter fonction de collecte
2. **Dans `monitor.py`**: Appeler la fonction, stocker dans dict
3. **Dans `reporter.py`**: Utiliser dans l'analyse
4. **Dans embed**: Afficher dans Discord

### Ajouter un nouveau type de rapport

1. CrÃ©er nouveau script `src/my_report.py`
2. Importer `HealthStorage` pour lire history
3. GÃ©nÃ©rer le format de sortie voulu (JSON, HTML, etc.)
4. CrÃ©er workflow n8n pour l'exÃ©cuter

### IntÃ©grer un nouveau service

1. **Grafana**: Exporter metrics vers Prometheus format
2. **API**: Wrapper Flask autour de HealthStorage
3. **Webhook**: Poster vers endpoint custom au lieu de Discord

---

VoilÃ  l'architecture complÃ¨te ! ğŸ—ï¸âœ¨
